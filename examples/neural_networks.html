
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Neural Networks &#8212; Nimble Alpha documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Merging and Tidying Data" href="merging_and_tidying_data.html" />
    <link rel="prev" title="Unsupervised Learning" href="unsupervised_learning.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Nimble</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cleaning_data.html">Cleaning Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="supervised_learning.html">Supervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploring_data.html">Exploring Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="unsupervised_learning.html">Unsupervised Learning</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="merging_and_tidying_data.html">Merging and Tidying Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional_functionality.html">Additional Functionality</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets.html">Example Datasets</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="unsupervised_learning.html" title="previous chapter">Unsupervised Learning</a></li>
      <li>Next: <a href="merging_and_tidying_data.html" title="next chapter">Merging and Tidying Data</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
    }
</style><section id="Neural-Networks">
<h1>Neural Networks<a class="headerlink" href="#Neural-Networks" title="Permalink to this headline">¶</a></h1>
<section id="Using-neural-networks-to-identify-handwritten-digits.">
<h2>Using neural networks to identify handwritten digits.<a class="headerlink" href="#Using-neural-networks-to-identify-handwritten-digits." title="Permalink to this headline">¶</a></h2>
<p>Our dataset contains 1593 flattened 16x16 black and white images (each pixel is represented by a 1 or 0) of handwritten digits (0-9). Approximately half of the digits were written neatly and the other half were written as quickly as possible. This provides some images that are very difficult for even the human eye to decipher correctly. Each point in our dataset will contain 266 features. The first 256 features represent pixel values for the flattened image. The last 10 features identify the
known label for the image using one-hot encoding. For example, [0,0,0,1,0,0,0,0,0,0] is a 3 and [0,0,0,0,0,0,0,0,0,1] is a 9.</p>
<p>In this example we will learn about:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Simple-neural-network">Creating a simple neural network</a></p></li>
<li><p><a class="reference external" href="#Simple-neural-network">Using objects from other packages as training parameters</a></p></li>
<li><p><a class="reference external" href="#Convolutional-Neural-Network">Creating a Convolutional Neural Network</a></p></li>
</ul>
<div class="line-block">
<div class="line"><a class="reference external" href="https://colab.research.google.com/drive/1o-1M9MWiqPdgXeAZ0RUDBN-ilx4J_rh1?usp=sharing">Open this example in Google Colab</a></div>
<div class="line"><a class="reference internal" href="files.html#neural-networks"><span class="std std-ref">Download this example as a script or notebook</span></a></div>
<div class="line"><a class="reference internal" href="../datasets.html#neural-networks"><span class="std std-ref">Download the dataset for this example</span></a></div>
</div>
<section id="Getting-Started">
<h3>Getting Started<a class="headerlink" href="#Getting-Started" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <a class="nimble-hyperlink" href="../docs/index.html" target="_blank"><span class="nn">nimble</span></a>

<span class="n">path</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.fetchFile.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">fetchFile</span></a><span class="p">(</span><span class="s1">&#39;uci::Semeion Handwritten Digit&#39;</span><span class="p">)</span>
<span class="n">images</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.data.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">data</span></a><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">returnType</span><span class="o">=</span><span class="s2">&quot;Matrix&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Preparing-the-data">
<h3>Preparing the data<a class="headerlink" href="#Preparing-the-data" title="Permalink to this headline">¶</a></h3>
<p>We need to separate the features identifying the labels (the last 10 features) from the features containing our image data. Using <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Features.extract.html"target="_blank"><span class="pre">features.extract</span></a></code> performs this separation. New labels are placed in the <code class="docutils literal notranslate"><span class="pre">labels</span></code> object and our <code class="docutils literal notranslate"><span class="pre">images</span></code> object now only contains our image data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Features.extract.html" target="_blank"><span class="n">features</span><span class="o">.</span><span class="n">extract</span></a><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.features.html" target="_blank"><span class="n">features</span></a><span class="p">)))</span>
<span class="n">labels</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.show.html" target="_blank"><span class="n">show</span></a><span class="p">(</span><span class="s1">&#39;one-hot encoded labels&#39;</span><span class="p">,</span> <span class="n">maxHeight</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
one-hot encoded labels
1593pt x 10ft
         0     1     2     3     4     5     6     7     8     9
     ┌────────────────────────────────────────────────────────────
   0 │ 1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
   1 │ 1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
   2 │ 1.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000
   │ │   │     │     │     │     │     │     │     │     │     │
1590 │ 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 1.000
1591 │ 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 1.000
1592 │ 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 0.000 1.000

</pre></div></div>
</div>
<p>Rather than 10 one-hot encoded features, we need our labels to be a single feature with the values 0-9 for our neural network. We can perform this conversion by matrix multiplying (with Python’s <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> matrix multiplication operator) our <code class="docutils literal notranslate"><span class="pre">labels</span></code> object (1593 x 10) by a feature vector with the sequential values 0-9 (10 x 1). Since each label contains nine <code class="docutils literal notranslate"><span class="pre">0</span></code> values and a single <code class="docutils literal notranslate"><span class="pre">1</span></code>, the only non-zero product is between the <code class="docutils literal notranslate"><span class="pre">1</span></code> value in the label and the value in the feature vector that
corresponds with the index of the label’s <code class="docutils literal notranslate"><span class="pre">1</span></code> value. So, we quickly create a 1593 x 1 object with our labels as the integers 0 through 9.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">intLabels</span> <span class="o">=</span> <span class="n">labels</span> <span class="o">@</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.data.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">data</span></a><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.T.html" target="_blank"><span class="n">T</span></a>
<span class="n">intLabels</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.show.html" target="_blank"><span class="n">show</span></a><span class="p">(</span><span class="s1">&#39;integer labels&#39;</span><span class="p">,</span> <span class="n">maxHeight</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
integer labels
1593pt x 1ft
         0
     ┌──────
   0 │ 0.000
   1 │ 0.000
   2 │ 0.000
   │ │   │
1590 │ 9.000
1591 │ 9.000
1592 │ 9.000

</pre></div></div>
</div>
<p>Now that we have a single feature of labels, we can randomly partition our data into training and testing sets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">images</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.trainAndTestSets.html" target="_blank"><span class="n">trainAndTestSets</span></a><span class="p">(</span><span class="n">testFraction</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                                       <span class="n">labels</span><span class="o">=</span><span class="n">intLabels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Simple-neural-network">
<h3>Simple neural network<a class="headerlink" href="#Simple-neural-network" title="Permalink to this headline">¶</a></h3>
<p>For this example, we will be using the <a class="reference external" href="https://keras.io">Keras</a> neural network package so it must be installed in the current environment. Our first task will be to build a simple Sequential model using Nimble’s interface with Keras. The <code class="docutils literal notranslate"><span class="pre">layers</span></code> argument for a Sequential object requires a list of Keras <code class="docutils literal notranslate"><span class="pre">Layer</span></code> objects. However, there is no need to import the objects directly from Keras. As long as Keras is installed, <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html"target="_blank"><span class="pre">nimble.Init</span></a></code> can search the interfaced package for the desired
objects and instantiate it with any keyword arguments. So we can avoid extra imports (i.e., <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">keras.layers</span> <span class="pre">import</span>&#160; <span class="pre">Dense,</span> <span class="pre">Dropout</span></code>) and there is no need to recall the package’s module names that contain the objects we want to use.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">layer0</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Dense&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">layer1</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Dropout&#39;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">layer2</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Dense&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer0</span><span class="p">,</span> <span class="n">layer1</span><span class="p">,</span> <span class="n">layer2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Now that our layers are defined, we can use <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.trainAndApply.html"target="_blank"><span class="pre">nimble.trainAndApply</span></a></code> to train the neural network with our trainX and trainY data and make predictions on our testX data. Similar to above, the string ‘keras.Sequential’ informs Nimble to use the Sequential object from Keras, so importing the object manually is not necessary.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">predictions</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.trainAndApply.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">trainAndApply</span></a><span class="p">(</span>
    <span class="s1">&#39;keras.Sequential&#39;</span><span class="p">,</span> <span class="n">trainX</span><span class="o">=</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="o">=</span><span class="n">trainY</span><span class="p">,</span> <span class="n">testX</span><span class="o">=</span><span class="n">testX</span><span class="p">,</span>
    <span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">accuracy</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.calculate.fractionCorrect.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">fractionCorrect</span></a><span class="p">(</span><span class="n">testY</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy of simple neural network:&#39;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/10
38/38 [==============================] - 0s 362us/step - loss: 2.1531 - accuracy: 0.2477
Epoch 2/10
38/38 [==============================] - 0s 414us/step - loss: 1.5089 - accuracy: 0.5289
Epoch 3/10
38/38 [==============================] - 0s 385us/step - loss: 1.1271 - accuracy: 0.6310
Epoch 4/10
38/38 [==============================] - 0s 407us/step - loss: 0.8847 - accuracy: 0.7213
Epoch 5/10
38/38 [==============================] - 0s 399us/step - loss: 0.7626 - accuracy: 0.7590
Epoch 6/10
38/38 [==============================] - 0s 425us/step - loss: 0.6595 - accuracy: 0.7992
Epoch 7/10
38/38 [==============================] - 0s 383us/step - loss: 0.5811 - accuracy: 0.8201
Epoch 8/10
38/38 [==============================] - 0s 394us/step - loss: 0.5395 - accuracy: 0.8368
Epoch 9/10
38/38 [==============================] - 0s 415us/step - loss: 0.4987 - accuracy: 0.8494
Epoch 10/10
38/38 [==============================] - 0s 409us/step - loss: 0.4243 - accuracy: 0.8803
Accuracy of simple neural network: 0.9095477386934674
</pre></div></div>
</div>
<p>Some older Keras versions rely on sources of randomness outside of Nimble’s control, so your exact result could vary from ours, but should be around 90% accurate. This is pretty good for a simple model only trained for 10 epochs.</p>
</section>
<section id="Convolutional-Neural-Network">
<h3>Convolutional Neural Network<a class="headerlink" href="#Convolutional-Neural-Network" title="Permalink to this headline">¶</a></h3>
<p>Let’s try to do better by increasing the complexity and creating a 2D convolutional neural network. This algorithm requires that our data be formatted so that it knows that each image is a 16 x 16 single channel (i.e., grayscale) image, so our flattened image data will not work. This will require each point to be a 3D (16 x 16 x 1) object. Fortunately, Nimble supports multi-dimensional data. We can reshape each point in our <code class="docutils literal notranslate"><span class="pre">trainX</span></code> and <code class="docutils literal notranslate"><span class="pre">testX</span></code> data using <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.unflatten.html"target="_blank"><span class="pre">unflatten</span></a></code>. Ultimately, this
allows Nimble to identify each object as a four-dimensional object (a container of 3D objects representing 2D grayscale images). It is worth noting that Nimble will treat the object as if it has more than two dimensions, but the underlying data object is always two-dimensional. For this reason, the <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.shape.html"target="_blank"><span class="pre">shape</span></a></code> attribute will always provide the two-dimensional shape and the <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.dimensions.html"target="_blank"><span class="pre">dimensions</span></a></code> attribute will provide the dimensions that Nimble considers the object to have (<code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.shape.html"target="_blank"><span class="pre">shape</span></a></code> and <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.dimensions.html"target="_blank"><span class="pre">dimensions</span></a></code>
are the same for 2D data).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">reshapePoint</span><span class="p">(</span><span class="n">pt</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.copy.html" target="_blank"><span class="n">copy</span></a><span class="p">()</span>
    <span class="n">ret</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.unflatten.html" target="_blank"><span class="n">unflatten</span></a><span class="p">((</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="n">trainX</span> <span class="o">=</span> <span class="n">trainX</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Points.calculate.html" target="_blank"><span class="n">points</span><span class="o">.</span><span class="n">calculate</span></a><span class="p">(</span><span class="n">reshapePoint</span><span class="p">)</span>
<span class="n">testX</span> <span class="o">=</span> <span class="n">testX</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Points.calculate.html" target="_blank"><span class="n">points</span><span class="o">.</span><span class="n">calculate</span></a><span class="p">(</span><span class="n">reshapePoint</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trainX.shape&#39;</span><span class="p">,</span> <span class="n">trainX</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.shape.html" target="_blank"><span class="n">shape</span></a><span class="p">,</span> <span class="s1">&#39;trainX.dimensions&#39;</span><span class="p">,</span> <span class="n">trainX</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.dimensions.html" target="_blank"><span class="n">dimensions</span></a><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;testX.shape&#39;</span><span class="p">,</span> <span class="n">testX</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.shape.html" target="_blank"><span class="n">shape</span></a><span class="p">,</span> <span class="s1">&#39;testX.dimensions&#39;</span><span class="p">,</span> <span class="n">testX</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.dimensions.html" target="_blank"><span class="n">dimensions</span></a><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
trainX.shape (1195, 256) trainX.dimensions (1195, 16, 16, 1)
testX.shape (398, 256) testX.dimensions (398, 16, 16, 1)
</pre></div></div>
</div>
<p>For our 2D convolutional neural network, we will need five different types of Keras <code class="docutils literal notranslate"><span class="pre">Layers</span></code> objects. Just as we did with our simple neural network above, we can use <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html"target="_blank"><span class="pre">nimble.Init</span></a></code> to instantiate these objects without directly importing them from Keras.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">layersCNN</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Conv2D&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Conv2D&#39;</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                             <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Dropout&#39;</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;MaxPooling2D&#39;</span><span class="p">,</span> <span class="n">pool_size</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Flatten&#39;</span><span class="p">))</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Dense&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">))</span>
<span class="n">layersCNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Init.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Init</span></a><span class="p">(</span><span class="s1">&#39;Dense&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">))</span>

<span class="n">predictionsCNN</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.trainAndApply.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">trainAndApply</span></a><span class="p">(</span>
    <span class="s1">&#39;keras.Sequential&#39;</span><span class="p">,</span> <span class="n">trainX</span><span class="o">=</span><span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="o">=</span><span class="n">trainY</span><span class="p">,</span> <span class="n">testX</span><span class="o">=</span><span class="n">testX</span><span class="p">,</span>
    <span class="n">layers</span><span class="o">=</span><span class="n">layersCNN</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/10
38/38 [==============================] - 0s 4ms/step - loss: 1.3493 - accuracy: 0.5632
Epoch 2/10
38/38 [==============================] - 0s 4ms/step - loss: 0.4476 - accuracy: 0.8577
Epoch 3/10
38/38 [==============================] - 0s 4ms/step - loss: 0.2512 - accuracy: 0.9238
Epoch 4/10
38/38 [==============================] - 0s 4ms/step - loss: 0.1554 - accuracy: 0.9456
Epoch 5/10
38/38 [==============================] - 0s 4ms/step - loss: 0.0790 - accuracy: 0.9749
Epoch 6/10
38/38 [==============================] - 0s 4ms/step - loss: 0.0781 - accuracy: 0.9715
Epoch 7/10
38/38 [==============================] - 0s 4ms/step - loss: 0.0436 - accuracy: 0.9908
Epoch 8/10
38/38 [==============================] - 0s 4ms/step - loss: 0.0341 - accuracy: 0.9900
Epoch 9/10
38/38 [==============================] - 0s 4ms/step - loss: 0.0110 - accuracy: 1.0000
Epoch 10/10
38/38 [==============================] - 0s 4ms/step - loss: 0.0082 - accuracy: 0.9992
</pre></div></div>
</div>
<p>We see that the loss and accuracy of this model improved much faster than our previous model. Let’s check how it performed on our test set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">accuracyCNN</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.calculate.fractionCorrect.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">fractionCorrect</span></a><span class="p">(</span><span class="n">testY</span><span class="p">,</span> <span class="n">predictionsCNN</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Accuracy of 2D convolutional neural network:&#39;</span><span class="p">,</span> <span class="n">accuracyCNN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Accuracy of 2D convolutional neural network: 0.9698492462311558
</pre></div></div>
</div>
<p>With the same amount of training, our convolutional neural network is about 6% more accurate than our simple neural network. Considering some images are very difficult to correctly identify because they were drawn as quickly as possible, nearly 97% accuracy is a significant improvement and a very good result.</p>
<p><strong>References:</strong></p>
<p>Semeion Research Center of Sciences of Communication, via Sersale 117, 00128 Rome, Italy Tattile Via Gaetano Donizetti, 1-3-5,25030 Mairano (Brescia), Italy</p>
<p>Dua, D. and Graff, C. (2019). UCI Machine Learning Repository [<a class="reference external" href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>]. Irvine, CA: University of California, School of Information and Computer Science.</p>
<p>Link to original dataset: <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Semeion+Handwritten+Digit">https://archive.ics.uci.edu/ml/datasets/Semeion+Handwritten+Digit</a></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, Spark Wave.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/examples/neural_networks.ipynb"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>