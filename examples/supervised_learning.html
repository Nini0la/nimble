
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Supervised Learning &#8212; Nimble Alpha documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Exploring Data" href="exploring_data.html" />
    <link rel="prev" title="Cleaning Data" href="cleaning_data.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Nimble</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cleaning_data.html">Cleaning Data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Supervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploring_data.html">Exploring Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="unsupervised_learning.html">Unsupervised Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="neural_networks.html">Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="merging_and_tidying_data.html">Merging and Tidying Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="additional_functionality.html">Additional Functionality</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cheatsheet.html">Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../datasets.html">Example Datasets</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cleaning_data.html" title="previous chapter">Cleaning Data</a></li>
      <li>Next: <a href="exploring_data.html" title="next chapter">Exploring Data</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
    }
</style><section id="Supervised-Learning">
<h1>Supervised Learning<a class="headerlink" href="#Supervised-Learning" title="Permalink to this headline">¶</a></h1>
<section id="Training-on-interstate-traffic-data-to-make-predictions-about-the-future">
<h2>Training on interstate traffic data to make predictions about the future<a class="headerlink" href="#Training-on-interstate-traffic-data-to-make-predictions-about-the-future" title="Permalink to this headline">¶</a></h2>
<p>In this example, we will use two datasets that contain data on interstate traffic volumes and features that may contribute to changes in traffic volume. <code class="docutils literal notranslate"><span class="pre">Metro_Interstate_Traffic_Volume_Cleaned.csv</span></code>, was generated in our <a href="cleaning_data.html" target="_blank">Cleaning Data example</a> and is the cleaned data we will use to build our supervised learning models. <code class="docutils literal notranslate"><span class="pre">Metro_Interstate_Traffic_Volume_Predict.csv</span></code>, contains fictional “forecast” data that we will use to simulate making traffic volume predictions using our supervised machine
learning model.</p>
<p>In this example we will learn about:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Test-five-different-machine-learning-algorithms">Testing machine learning algorithms</a></p></li>
<li><p><a class="reference external" href="#Improve-performance-by-tuning-hyperparameters">Hyperparameter tuning</a></p></li>
<li><p><a class="reference external" href="#Improve-performance-by-tuning-hyperparameters">Nimble’s TraineLearner class</a></p></li>
<li><p><a class="reference external" href="#Applying-our-learner">Applying a learner to new data</a></p></li>
</ul>
<div class="line-block">
<div class="line"><a class="reference external" href="https://colab.research.google.com/drive/1XAqGkVFdI7UbJiegabkx5PynKZU-za3W?usp=sharing">Open this example in Google Colab</a></div>
<div class="line"><a class="reference internal" href="files.html#supervised-learning"><span class="std std-ref">Download this example as a script or notebook</span></a></div>
<div class="line"><a class="reference internal" href="../datasets.html#supervised-learning"><span class="std std-ref">Download the dataset for this example</span></a></div>
</div>
<section id="Getting-Started">
<h3>Getting Started<a class="headerlink" href="#Getting-Started" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <a class="nimble-hyperlink" href="../docs/index.html" target="_blank"><span class="nn">nimble</span></a>

<span class="n">bucket</span> <span class="o">=</span> <span class="s1">&#39;https://storage.googleapis.com/nimble/datasets/&#39;</span>
<span class="n">traffic</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.data.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">data</span></a><span class="p">(</span><span class="n">bucket</span> <span class="o">+</span> <span class="s1">&#39;Metro_Interstate_Traffic_Volume_Cleaned.csv&#39;</span><span class="p">,</span>
                      <span class="n">returnType</span><span class="o">=</span><span class="s2">&quot;Matrix&quot;</span><span class="p">)</span>
<span class="n">forecast</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.data.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">data</span></a><span class="p">(</span><span class="n">bucket</span> <span class="o">+</span> <span class="s1">&#39;Metro_Interstate_Traffic_Volume_Predict.csv&#39;</span><span class="p">,</span>
                       <span class="n">returnType</span><span class="o">=</span><span class="s2">&quot;Matrix&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Test-five-different-machine-learning-algorithms">
<h3>Test five different machine learning algorithms<a class="headerlink" href="#Test-five-different-machine-learning-algorithms" title="Permalink to this headline">¶</a></h3>
<p>We’ll divide our <code class="docutils literal notranslate"><span class="pre">traffic</span></code> data into training and testing sets. The test set (used to measure the out-of-sample performance) will contain 25% of our data and the remaining 75% will be used to train each machine learning algorithm.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">testFraction</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">yFeature</span> <span class="o">=</span> <span class="s1">&#39;traffic_volume&#39;</span>
<span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span> <span class="o">=</span> <span class="n">traffic</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.trainAndTestSets.html" target="_blank"><span class="n">trainAndTestSets</span></a><span class="p">(</span><span class="n">testFraction</span><span class="p">,</span> <span class="n">yFeature</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For this example, we will use algorithms from the <a class="reference external" href="https://scikit-learn.org/">Sci-kit Learn</a> package so it must be installed in the current environment. To check if Nimble has access to Sci-kit Learn in your environment, you can use <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.showAvailablePackages.html"target="_blank"><span class="pre">nimble.showAvailablePackages</span></a></code>. Additionally, we can see a list of all of the learners available to Nimble by using <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.showLearnerNames.html"target="_blank"><span class="pre">nimble.showLearnerNames</span></a></code>. Uncomment the lines below if you would like to see the available packages and learners in your environment.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># nimble.showAvailablePackages()</span>
<span class="c1"># nimble.showLearnerNames()</span>
</pre></div>
</div>
</div>
<p>Nimble’s training functions only need the package name and learner name to be identified. There is no need to recall, for example, that <code class="docutils literal notranslate"><span class="pre">LinearRegression</span></code> is in <code class="docutils literal notranslate"><span class="pre">sklearn.linear_model</span></code> or <code class="docutils literal notranslate"><span class="pre">KNeighborsRegressor</span></code> is in <code class="docutils literal notranslate"><span class="pre">sklearn.neighbors</span></code>, all Nimble requires are the strings ‘sklearn.LinearRegression’ and ‘sklearn.KNeighborsRegressor’, respectively. Using <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.trainAndTest.html"target="_blank"><span class="pre">nimble.trainAndTest</span></a></code>, we will quickly test the performance of five different regression algorithms (initially, we’ll use default
arguments to keep things simple). We can then analyze the performance by comparing each learning algorithm’s root mean square error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">learners</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sklearn.LinearRegression&#39;</span><span class="p">,</span> <span class="s1">&#39;sklearn.Ridge&#39;</span><span class="p">,</span> <span class="s1">&#39;sklearn.Lasso&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sklearn.KNeighborsRegressor&#39;</span><span class="p">,</span> <span class="s1">&#39;sklearn.GradientBoostingRegressor&#39;</span><span class="p">]</span>
<span class="n">rootMeanSquareError</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.calculate.rootMeanSquareError.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">calculate</span><span class="o">.</span><span class="n">rootMeanSquareError</span></a>
<span class="k">for</span> <span class="n">learner</span> <span class="ow">in</span> <span class="n">learners</span><span class="p">:</span>
    <span class="n">performance</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.trainAndTest.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">trainAndTest</span></a><span class="p">(</span><span class="n">learner</span><span class="p">,</span> <span class="n">rootMeanSquareError</span><span class="p">,</span> <span class="n">trainX</span><span class="p">,</span>
                                      <span class="n">trainY</span><span class="p">,</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">learner</span><span class="p">,</span> <span class="s1">&#39;error:&#39;</span><span class="p">,</span> <span class="n">performance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sklearn.LinearRegression error: 1797.196156095044
sklearn.Ridge error: 1797.1709026127887
sklearn.Lasso error: 1797.2099274597363
sklearn.KNeighborsRegressor error: 810.4261796749433
sklearn.GradientBoostingRegressor error: 521.5527337889073
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">'sklearn.KNeighborsRegressor'</span></code> and <code class="docutils literal notranslate"><span class="pre">'sklearn.GradientBoostingRegressor'</span></code> had better performance for predicting traffic volume with this data than the linear regression based learners, so let’s focus on optimizing those two.</p>
</section>
<section id="Improve-performance-by-tuning-hyperparameters">
<h3>Improve performance by tuning hyperparameters<a class="headerlink" href="#Improve-performance-by-tuning-hyperparameters" title="Permalink to this headline">¶</a></h3>
<p>The default arguments are unlikely to yield the best performance, so now we will adjust some parameter values for our two best learners. These adjustments can be made through <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.arguments.html"target="_blank"><span class="pre">arguments</span></a></code> as a python <code class="docutils literal notranslate"><span class="pre">dict</span></code> or as keyword arguments. If we need more information about a learner’s parameters, we can use <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.learnerParameters.html"target="_blank"><span class="pre">nimble.learnerParameters</span></a></code> and <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.learnerParameterDefaults.html"target="_blank"><span class="pre">nimble.learnerParameterDefaults</span></a></code>. Let’s try it for KNeighborsRegressor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><a class="nimble-hyperlink" href="../docs/generated/nimble.showLearnerParameters.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">showLearnerParameters</span></a><span class="p">(</span><span class="s1">&#39;sklearn.KNeighborsRegressor&#39;</span><span class="p">)</span>
<a class="nimble-hyperlink" href="../docs/generated/nimble.showLearnerParameterDefaults.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">showLearnerParameterDefaults</span></a><span class="p">(</span><span class="s1">&#39;sklearn.KNeighborsRegressor&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
algorithm
leaf_size
metric
metric_params
n_jobs
n_neighbors
p
weights
algorithm      &#39;auto&#39;
leaf_size      30
metric         &#39;minkowski&#39;
metric_params  None
n_jobs         None
n_neighbors    5
p              2
weights        &#39;uniform&#39;
</pre></div></div>
</div>
<p>Furthermore, we can test multiple values for the same parameter by using the <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tune.html"target="_blank"><span class="pre">nimble.Tune</span></a></code> object. The presence of <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tune.html"target="_blank"><span class="pre">nimble.Tune</span></a></code> will trigger hyperparameter tuning. By default, this tunes the arguments consecutively (optimizing one argument at a time while holding the others constant) and uses 5-fold cross-validation. This can be modified by providing a <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tuning.html"target="_blank"><span class="pre">Tuning</span></a></code> object to the <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.tuning.html"target="_blank"><span class="pre">tuning</span></a></code> parameter. The tuning will find the argument combination with the best average <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.calculate.performanceFunction.html"target="_blank"><span class="pre">performanceFunction</span></a></code>
result and return the <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.html"target="_blank"><span class="pre">TrainedLearner</span></a></code> using the best arguments.</p>
<p>For KNeighborsRegressor, we will use <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tune.html"target="_blank"><span class="pre">nimble.Tune</span></a></code> to try 3, 5, and 7 for the number of nearest neighbors and for <code class="docutils literal notranslate"><span class="pre">GradientBoostingRegressor</span></code> we will try different learning rate values. The <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tuning.html"target="_blank"><span class="pre">Tuning</span></a></code> object defines a method for selecting each argument set and how each argument set will be validated. Below, we will use the default “consecutive” method but instead of the default “cross validation”, we will hold out a random 20% of our training data for validation. For details on all tuning
options, see the <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tuning.html"target="_blank"><span class="pre">Tuning</span></a></code> documentation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tuning</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.Tuning.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Tuning</span></a><span class="p">(</span><span class="n">validation</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">performanceFunction</span><span class="o">=</span><span class="n">rootMeanSquareError</span><span class="p">)</span>
<span class="c1"># some interfaces have alias options for the package name</span>
<span class="c1"># below we use the alias &#39;skl&#39; for the &#39;sklearn&#39; package.</span>
<span class="n">knnTL</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.train.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">train</span></a><span class="p">(</span><span class="s1">&#39;skl.KNeighborsRegressor&#39;</span><span class="p">,</span> <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span>
                     <span class="n">arguments</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_neighbors&#39;</span><span class="p">:</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.Tune.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Tune</span></a><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">])},</span>
                     <span class="n">tuning</span><span class="o">=</span><span class="n">tuning</span><span class="p">)</span>
<span class="n">gbTL</span> <span class="o">=</span> <a class="nimble-hyperlink" href="../docs/generated/nimble.train.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">train</span></a><span class="p">(</span><span class="s1">&#39;skl.GradientBoostingRegressor&#39;</span><span class="p">,</span> <span class="n">trainX</span><span class="p">,</span> <span class="n">trainY</span><span class="p">,</span>
                    <span class="n">learning_rate</span><span class="o">=</span><a class="nimble-hyperlink" href="../docs/generated/nimble.Tune.html" target="_blank"><span class="n">nimble</span><span class="o">.</span><span class="n">Tune</span></a><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span>
                    <span class="n">tuning</span><span class="o">=</span><span class="n">tuning</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.train.html"target="_blank"><span class="pre">nimble.train</span></a></code> function returns a <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.html"target="_blank"><span class="pre">TrainedLearner</span></a></code>. With a <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.html"target="_blank"><span class="pre">TrainedLearner</span></a></code> we can <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.apply.html"target="_blank"><span class="pre">apply</span></a></code> (make predictions on a test set), <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.test.html"target="_blank"><span class="pre">test</span></a></code> (measure the performance on a test set with known labels) and it provides many other additional methods and attributes. The <code class="docutils literal notranslate"><span class="pre">knnTL</span></code> object was trained with the <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> value that performed best during validation. When hyperparameter tuning occured, <code class="docutils literal notranslate"><span class="pre">TrainedLearner.tuning</span></code> provides access to the tuning results. The <code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tuning.allResults.html"target="_blank"><span class="pre">allResults</span></a></code> and
<code class="docutils literal notranslate"><a class="nimble-hyperlink" href="../docs/generated/nimble.Tuning.allArguments.html"target="_blank"><span class="pre">allArguments</span></a></code> properties are sorted from best to worst. Let’s see how each <code class="docutils literal notranslate"><span class="pre">knnTL</span></code> argument performed.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">for</span> <span class="n">result</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">knnTL</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.tuning.html" target="_blank"><span class="n">tuning</span></a><span class="o">.</span><span class="n">allResults</span><span class="p">,</span> <span class="n">knnTL</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.tuning.html" target="_blank"><span class="n">tuning</span></a><span class="o">.</span><span class="n">allArguments</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
862.3395894477584 {&#39;n_neighbors&#39;: 3}
873.1601532632193 {&#39;n_neighbors&#39;: 5}
895.1012627233006 {&#39;n_neighbors&#39;: 7}
</pre></div></div>
</div>
<p>Similarly <code class="docutils literal notranslate"><span class="pre">gbTL</span></code> was trained with the best of our three possible learning rates. Instead of seeing all the results, let’s just see the best argument and best result this time.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">gbTL</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.tuning.html" target="_blank"><span class="n">tuning</span></a><span class="o">.</span><span class="n">bestResult</span><span class="p">,</span> <span class="n">gbTL</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.tuning.html" target="_blank"><span class="n">tuning</span></a><span class="o">.</span><span class="n">bestArguments</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
407.64432128552454 {&#39;learning_rate&#39;: 1}
</pre></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">knnTL</span></code> found <code class="docutils literal notranslate"><span class="pre">n_neighbors</span></code> of 5 to be the best setting. This is the same as the default value so we already know how it performs on our testing data. However, <code class="docutils literal notranslate"><span class="pre">gbTL</span></code> found <code class="docutils literal notranslate"><span class="pre">learning_rate</span></code> of 1 outperformed the default, 0.1. Let’s see how it performs on our testing (out-of-sample) data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gbPerf</span> <span class="o">=</span> <span class="n">gbTL</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.test.html" target="_blank"><span class="n">test</span></a><span class="p">(</span><span class="n">rootMeanSquareError</span><span class="p">,</span> <span class="n">testX</span><span class="p">,</span> <span class="n">testY</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sklearn.GradientBoostingRegressor&#39;</span><span class="p">,</span> <span class="s1">&#39;learning_rate=1&#39;</span><span class="p">,</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">gbPerf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sklearn.GradientBoostingRegressor learning_rate=1 error 387.21336096978916
</pre></div></div>
</div>
</section>
<section id="Applying-our-learner">
<h3>Applying our learner<a class="headerlink" href="#Applying-our-learner" title="Permalink to this headline">¶</a></h3>
<p>We see a further improvement in the performance so the GradientBoostingRegressor with a learning rate of 1 is our best model. Now we will apply our <code class="docutils literal notranslate"><span class="pre">gbTL</span></code> trained learner to our <code class="docutils literal notranslate"><span class="pre">forecast</span></code> dataset to predict traffic volumes for a future day.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">predictedTraffic</span> <span class="o">=</span> <span class="n">gbTL</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.interfaces.TrainedLearner.apply.html" target="_blank"><span class="n">apply</span></a><span class="p">(</span><span class="n">forecast</span><span class="p">)</span>
<span class="n">predictedTraffic</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Features.setName.html" target="_blank"><span class="n">features</span><span class="o">.</span><span class="n">setName</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Before printing, we will append the <code class="docutils literal notranslate"><span class="pre">hour</span></code> feature from <code class="docutils literal notranslate"><span class="pre">forecasts</span></code> to get a better visual of the traffic throughout the day.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">predictedTraffic</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Features.append.html" target="_blank"><span class="n">features</span><span class="o">.</span><span class="n">append</span></a><span class="p">(</span><span class="n">forecast</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.features.html" target="_blank"><span class="n">features</span></a><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">])</span>
<span class="n">predictedTraffic</span><span class="o">.</span><a class="nimble-hyperlink" href="../docs/generated/nimble.core.data.Base.show.html" target="_blank"><span class="n">show</span></a><span class="p">(</span><span class="s1">&#39;Traffic Volume Predictions&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Traffic Volume Predictions
24pt x 2ft
     &#39;volume&#39; &#39;hour&#39;
   ┌────────────────
 0 │ 843.531  0.000
 1 │ 554.283  1.000
 2 │ 369.775  2.000
 3 │ 322.198  3.000
 4 │ 704.739  4.000
 5 │ 2717.663 5.000
 6 │ 5280.962 6.000
 7 │ 6005.379 7.000
 8 │ 5725.392 8.000
 9 │ 4795.982 9.000
10 │ 4476.673 10.000
11 │ 4704.517 11.000
12 │ 4996.067 12.000
13 │ 4995.874 13.000
14 │ 5476.592 14.000
15 │ 5911.463 15.000
16 │ 5986.865 16.000
17 │ 5849.879 17.000
18 │ 4583.712 18.000
19 │ 3394.054 19.000
20 │ 2976.204 20.000
21 │ 2819.376 21.000
22 │ 2620.460 22.000
23 │ 2078.026 23.000

</pre></div></div>
</div>
<p>Based on our forecasted data, our learner is predicting heavier traffic volumes between 6 am and 6 pm with peak congestion expected around the 7 am hour for the morning commute and the 4 pm hour for the afternoon commute.</p>
<p><strong>Reference:</strong></p>
<p>Dua, D. and Graff, C. (2019). UCI Machine Learning Repository [<a class="reference external" href="http://archive.ics.uci.edu/ml">http://archive.ics.uci.edu/ml</a>]. Irvine, CA: University of California, School of Information and Computer Science.</p>
<p>Link to original dataset: <a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Metro+Interstate+Traffic+Volume">https://archive.ics.uci.edu/ml/datasets/Metro+Interstate+Traffic+Volume</a></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2022, Spark Wave.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/examples/supervised_learning.ipynb"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>